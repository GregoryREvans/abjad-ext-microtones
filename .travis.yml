language: python
dist: xenial
sudo: false
python:
- 3.8

env:
  global:
  - LILYPOND_URL="http://lilypond.org/downloads/binaries/linux-64/"
  - LILYPOND_VERSION=2.19.84

before_install:
- LOCATION=`pwd`

# upgrade pip:
- pip install --upgrade pip

# install flake8:
- pip install flake8

# install isort:
- pip install isort

# alias package:
- PACKAGE=`pwd`/abjadext
- export PYTHONPATH=$PACKAGE:$PYTHONPATH
# from josiah
- wget -q ${LILYPOND_URL}lilypond-${LILYPOND_VERSION}-1.linux-64.sh
- sh lilypond-$LILYPOND_VERSION-1.linux-64.sh --batch
- export PATH=/home/travis/bin:$PATH
- pip install -U pip regex
- export ABJAD_ARCHIVE=https://github.com/Abjad/abjad/archive/master.zip
- pip install -U $ABJAD_ARCHIVE
- pip install --no-deps --target /tmp/typehints $ABJAD_ARCHIVE
- pip install --no-deps --target /tmp/typehints uqbar
- export MYPYPATH=/tmp/typehints
# clone & install rmakers:
- RMAKERS=/tmp/abjad-ext-rmakers
- git clone https://github.com/Abjad/abjad-ext-rmakers.git $RMAKERS
- cd $RMAKERS
- pip install -e $RMAKERS
- cd $LOCATION
- export MYPYPATH=$MYPYPATH:$RMAKERS
# clone & install evans:
- EVANS=/tmp/evans
- git clone https://github.com/GregoryREvans/evans.git $EVANS
- export PYTHONPATH=$EVANS/:$PYTHONPATH
- export PATH=$EVANS/evans/scr/:$PATH
# clone & install baca:
- BACA=/tmp/baca
- git clone https://github.com/trevorbaca/baca.git $BACA
- export PYTHONPATH=$BACA/:$PYTHONPATH
# clone & install tsmakers:
- TSMAKERS=/tmp/tsmakers
- git clone https://github.com/ivanalexandermoscotta/tsmakers.git $TSMAKERS
- export PYTHONPATH=$TSMAKERS:$PYTHONPATH

install:
- cd $PACKAGE/..
- pip install -e .
- cd $LOCATION
- black --version
- flake8 --version
# - mypy --version
# - pytest --version

script:
- black-check .
- flake8-check .
- isort-check .
- evans-doctest .

after_success:
- pip install --quiet coveralls
- coveralls
